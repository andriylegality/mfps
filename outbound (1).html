<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MFPS v4.1 â€” Material Flow Protection System</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap');
:root{
  --navy:#0A1F3F;--blue:#0058A3;--teal:#00838F;--red:#E21F26;--green:#0D8048;--gold:#B8860B;
  --bg:#F5F6FA;--card:#FFF;--txt:#1A1A2E;--txt2:#4B5563;--muted:#9CA3AF;--bdr:#E5E7EB;
  --r:12px;--r2:16px;--extreme:#DC2626;--high:#EA580C;--medium:#D97706;--low:#16A34A;
  --p-lime:#A8B400;
}
*{margin:0;padding:0;box-sizing:border-box}

/* ===== MOBILE BASE ===== */
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--txt);max-width:430px;margin:0 auto;min-height:100vh;position:relative;overflow-x:hidden}

.sbar{background:var(--navy);color:#fff;padding:6px 16px;font-size:10px;display:flex;justify-content:space-between}
.sbar-t{font-family:'JetBrains Mono',monospace;font-weight:600}

.hdr{background:#fff;padding:12px 16px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.hdr-l{display:flex;align-items:center;gap:10px}
.hdr-bk{width:32px;height:32px;border-radius:8px;border:1px solid var(--bdr);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--txt2);font-size:14px;background:#fff}
.hdr-tt{font-size:15px;font-weight:700}.hdr-sub{font-size:10px;color:var(--muted)}
.hdr-r{display:flex;gap:6px}
.hdr-btn{width:32px;height:32px;border-radius:8px;border:1px solid var(--bdr);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--txt2);font-size:13px;background:#fff;position:relative}
.hdr-dot{position:absolute;top:4px;right:4px;width:7px;height:7px;border-radius:50%;background:var(--red);border:1.5px solid #fff}

.off-ban{display:none;background:var(--extreme);color:#fff;padding:8px 16px;font-size:11px;text-align:center;font-weight:600}
.off-ban.show{display:block}

.scr{display:none;animation:fi .25s ease}.scr.on{display:block}
@keyframes fi{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* LOGIN */
.lg{display:flex;flex-direction:column;align-items:center;padding:20px 20px 30px;min-height:100vh;background:linear-gradient(180deg,#F4F6FA,#E8ECF4)}
.lg-logos{display:flex;align-items:center;gap:14px;margin-bottom:6px}
.lg-shield{width:72px;height:84px;background:linear-gradient(180deg,#1B3A6B 0%,#0A1F3F 100%);display:flex;align-items:center;justify-content:center;flex-direction:column;color:#fff;font-size:14px;clip-path:polygon(50% 0%,100% 12%,100% 75%,50% 100%,0% 75%,0% 12%);box-shadow:0 4px 18px rgba(10,31,63,.35);position:relative;border:none}
.lg-brand{text-align:center;margin-bottom:20px}
.lg-brand h1{font-size:22px;font-weight:900;color:var(--navy);letter-spacing:-.5px}
.lg-brand p{font-size:10.5px;color:var(--txt2);margin-top:2px}
.lg-sec{font-size:8.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.4px;color:var(--muted);margin:10px 0 8px;padding-left:2px;width:100%}
.lg-roles{width:100%}

.rc{display:flex;align-items:center;gap:11px;padding:12px 14px;background:#fff;border-radius:var(--r);border:1.5px solid var(--bdr);margin-bottom:7px;cursor:pointer;transition:all .15s}
.rc:hover{border-color:var(--blue);background:#F0F7FF}
.rc.sel{border-color:var(--red);background:#FEF2F2;box-shadow:0 0 0 3px rgba(226,31,38,.1)}
.rc-i{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;color:#fff;flex-shrink:0}
.rc-info{flex:1}.rc-n{font-size:12px;font-weight:700}.rc-d{font-size:9.5px;color:var(--txt2)}
.rc-step{font-size:8px;font-weight:700;color:var(--muted);font-family:'JetBrains Mono',monospace;flex-shrink:0}

.lg-btn{width:100%;padding:13px;border-radius:var(--r);background:var(--red);color:#fff;font-size:14px;font-weight:700;font-family:inherit;border:none;cursor:pointer;margin-top:10px;transition:background .15s}
.lg-btn:hover{background:#B91A20}
.lg-btn:disabled{background:var(--bdr);color:var(--muted);cursor:not-allowed}
.lg-foot{margin-top:14px;font-size:9px;color:var(--muted);text-align:center;display:flex;align-items:center;gap:5px}
.lg-dot{width:6px;height:6px;border-radius:50%;background:var(--green)}

/* DEST SELECT */
.dest-hd{font-size:11px;font-weight:700;color:var(--blue);margin-bottom:10px;display:flex;align-items:center;gap:6px}
.dest-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.dc{padding:16px 10px;border-radius:var(--r);border:1.5px solid var(--bdr);cursor:pointer;text-align:center;background:#fff;transition:all .15s}
.dc:hover{border-color:var(--blue);background:#F0F7FF}
.dc.sel{border-color:var(--red);background:#FEF2F2;box-shadow:0 0 0 3px rgba(226,31,38,.1)}
.dc i{font-size:22px;color:var(--blue);display:block;margin-bottom:6px}
.dc b{font-size:12px;display:block}.dc small{font-size:9px;color:var(--txt2)}

/* CARDS */
.cd{background:#fff;border-radius:var(--r2);border:1px solid var(--bdr);overflow:hidden;margin-bottom:12px;box-shadow:0 1px 3px rgba(0,0,0,.04)}
.cd-h{padding:11px 14px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between}
.cd-t{font-size:12.5px;font-weight:700;display:flex;align-items:center;gap:6px}
.cd-t i{font-size:13px;color:var(--blue)}
.cd-b{padding:14px}
.badge{font-size:8px;font-weight:700;padding:3px 8px;border-radius:10px;text-transform:uppercase;letter-spacing:.3px}
.b-r{background:#FEE2E2;color:var(--extreme)}.b-g{background:#DCFCE7;color:var(--low)}.b-b{background:#DBEAFE;color:#2563EB}.b-o{background:#FED7AA;color:var(--high)}.b-n{background:#E0E7FF;color:#3730A3}.b-gd{background:#FEF3C7;color:#92400E}

/* FORM */
.fs{margin-bottom:14px}
.fs h3{font-size:11px;font-weight:700;color:var(--blue);margin-bottom:8px;display:flex;align-items:center;gap:6px;padding-bottom:5px;border-bottom:2px solid var(--blue)}
.fs h3 i{font-size:12px}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
.fr.f1{grid-template-columns:1fr}
.fg{display:flex;flex-direction:column}
.fg label{font-size:9px;font-weight:700;color:var(--txt2);margin-bottom:3px;text-transform:uppercase;letter-spacing:.4px}
.fg input,.fg select,.fg textarea{padding:10px 12px;border:1.5px solid var(--bdr);border-radius:var(--r);font-size:13px;font-family:inherit;transition:all .15s;background:#fff;-webkit-appearance:none}
.fg input:focus,.fg select:focus{outline:none;border-color:var(--blue);box-shadow:0 0 0 3px rgba(0,88,163,.08)}
.fg select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}

/* STEPS */
.steps{display:flex;gap:0;margin-bottom:14px;padding:0 2px}
.stp{flex:1;display:flex;flex-direction:column;align-items:center;position:relative}
.stp-dot{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#fff;z-index:2;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.stp-dot.dn{background:var(--green)}.stp-dot.cr{background:var(--blue);animation:sp 2s infinite}.stp-dot.wt{background:var(--bdr);color:var(--muted)}
@keyframes sp{0%,100%{box-shadow:0 0 0 0 rgba(0,88,163,.3)}50%{box-shadow:0 0 0 8px rgba(0,88,163,0)}}
.stp-ln{position:absolute;top:13px;left:50%;width:100%;height:2px;background:var(--bdr);z-index:1}
.stp-ln.dn{background:var(--green)}
.stp:last-child .stp-ln{display:none}
.stp-lb{font-size:7.5px;font-weight:600;color:var(--txt2);margin-top:3px;text-align:center;max-width:52px;line-height:1.2}

/* QUEUE */
.qi{padding:11px 14px;border-bottom:1px solid var(--bdr);display:flex;gap:10px;align-items:flex-start;cursor:pointer;transition:background .15s}
.qi:hover{background:#F8FAFC}.qi:last-child{border-bottom:none}
.qi-i{width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:13px;color:#fff;flex-shrink:0}
.qi-inf{flex:1;min-width:0}.qi-tt{font-size:11.5px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.qi-m{font-size:10px;color:var(--txt2);margin-top:1px;line-height:1.4}
.qi-r{text-align:right;flex-shrink:0}.qi-tm{font-size:9px;color:var(--muted);font-family:'JetBrains Mono',monospace}

/* CHECK */
.ck{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--bdr)}
.ck:last-child{border-bottom:none}
.ck-bx{width:26px;height:26px;border-radius:7px;border:2px solid var(--bdr);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;color:transparent;transition:all .15s;flex-shrink:0}
.ck-bx.ok{background:var(--green);border-color:var(--green);color:#fff}
.ck-bx.fl{background:var(--extreme);border-color:var(--extreme);color:#fff}
.ck-lb{font-size:11.5px;flex:1}.ck-st{font-size:8.5px;font-weight:700}

/* BUTTONS */
.btn{width:100%;padding:13px;border-radius:var(--r);font-size:13px;font-weight:700;font-family:inherit;cursor:pointer;border:none;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:6px}
.btn-bl{background:var(--blue);color:#fff}.btn-rd{background:var(--red);color:#fff}
.btn-gn{background:var(--green);color:#fff}.btn-gd{background:linear-gradient(135deg,var(--gold),#D4A017);color:#fff}
.btn-ol{background:#fff;border:1.5px solid var(--bdr);color:var(--txt2)}
.btn-sm{width:auto;padding:8px 14px;font-size:11px}
.btn-rw{display:flex;gap:8px}.btn-rw .btn{flex:1}

/* ALERT */
.al{padding:10px 12px;border-radius:var(--r);margin-bottom:10px;font-size:10.5px;line-height:1.5;border-left:3px solid;display:flex;gap:8px;align-items:flex-start}
.al i{margin-top:1px;flex-shrink:0;font-size:12px}
.al-r{background:#FEF2F2;border-color:var(--extreme);color:#7F1D1D}
.al-g{background:#F0FDF4;border-color:var(--green);color:#14532D}
.al-b{background:#EFF6FF;border-color:#2563EB;color:#1E3A5F}
.al-y{background:#FFFBEB;border-color:var(--medium);color:#78350F}
.al-o{background:#FFF7ED;border-color:var(--high);color:#7C2D12}

.mono{font-family:'JetBrains Mono',monospace;font-size:10.5px}
.sr{display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--bdr);font-size:11px}
.sr:last-child{border-bottom:none}
.sr-l{color:var(--txt2)}.sr-v{font-weight:700}

.stamp{display:inline-flex;align-items:center;gap:5px;padding:5px 10px;border-radius:var(--r);font-size:10px;font-weight:700;border:2px dashed}
.st-g{border-color:var(--green);color:var(--green);background:#F0FDF4}
.st-gd{border-color:var(--gold);color:#92400E;background:#FEF3C7}
.st-r{border-color:var(--extreme);color:var(--extreme);background:#FEF2F2}

/* ===== DESKTOP 768px+ â€” FULL-WIDTH LANDSCAPE ===== */
@media(min-width:768px){
  body{
    max-width:none;
    margin:0;
    background:var(--bg);
    overflow-x:hidden;
  }

  /* Login / Role selection â€” centered card */
  #s-login .lg{
    min-height:100vh;
    padding:40px 20px;
    background:linear-gradient(160deg,#0A1F3F 0%,#0E3B69 50%,#0A1F3F 100%);
    align-items:center;
  }
  #s-login .lg-brand h1{font-size:28px;color:#fff}
  #s-login .lg-brand p{color:rgba(255,255,255,.65);font-size:12px}
  #s-login .lg-brand>div{color:var(--gold)!important}

  #s-login .lg-logos img{filter:drop-shadow(0 6px 20px rgba(0,0,0,.5))}

  #s-login .lg-roles{
    max-width:640px;
    width:100%;
  }
  #s-login .lg-sec{color:rgba(255,255,255,.4)}

  /* Role cards 2-column on desktop */
  #s-login .lg-roles > .rc:nth-child(odd){margin-right:0}
  #s-login .role-grid-desk{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin-bottom:10px;
  }
  #s-login .rc{
    background:rgba(255,255,255,.08);
    border-color:rgba(255,255,255,.12);
    color:#fff;
    margin-bottom:0;
  }
  #s-login .rc:hover{background:rgba(255,255,255,.16);border-color:rgba(255,255,255,.3)}
  #s-login .rc.sel{background:rgba(226,31,38,.25);border-color:var(--red);box-shadow:0 0 0 3px rgba(226,31,38,.2)}
  #s-login .rc-n{color:#fff}
  #s-login .rc-d{color:rgba(255,255,255,.6)}
  #s-login .rc-step{color:rgba(255,255,255,.3)}

  #s-login .lg-btn{max-width:640px;font-size:15px;padding:15px}
  #s-login .lg-foot{color:rgba(255,255,255,.3)}

  /* Non-login screens â€” full width centered */
  .scr:not(#s-login){
    background:var(--bg);
    min-height:100vh;
  }

  /* Header full-width */
  .hdr{
    padding:14px 40px;
    max-width:none;
    border-bottom:1px solid var(--bdr);
    box-shadow:0 1px 8px rgba(0,0,0,.06);
  }
  .hdr-tt{font-size:17px}

  /* Content area â€” centered with max-width */
  .desk-content{
    max-width:1200px;
    margin:0 auto;
    padding:28px 40px 80px;
  }

  /* Steps bar full width */
  .steps{
    background:#fff;
    padding:16px 24px;
    border-radius:12px;
    border:1px solid var(--bdr);
    box-shadow:0 1px 4px rgba(0,0,0,.04);
    margin-bottom:20px;
  }

  /* 2-column grid for form sections */
  .desk-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:18px;
    align-items:start;
  }
  .desk-grid-full{grid-column:1/-1}

  /* Form sections as cards */
  .fs{
    background:#fff;
    border-radius:14px;
    padding:18px 20px;
    border:1px solid var(--bdr);
    box-shadow:0 1px 4px rgba(0,0,0,.04);
    margin-bottom:0;
  }

  /* Cards wider */
  .cd{margin-bottom:16px}

  /* Queue list 2-column */
  .queue-desk-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
  }

  /* Dest grid wider */
  .dest-grid{grid-template-columns:repeat(4,1fr);gap:12px}
  .dc{padding:20px 12px}
  .dc i{font-size:28px}

  .al{margin-bottom:12px}

  .off-ban{
    position:fixed;
    top:0;left:0;right:0;
    z-index:200;
  }

  ::-webkit-scrollbar{width:5px}
  ::-webkit-scrollbar-track{background:transparent}
  ::-webkit-scrollbar-thumb{background:rgba(0,0,0,.12);border-radius:3px}
  ::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,.22)}
}

@media(min-width:1200px){
  .desk-content{padding:32px 60px 100px}
  .desk-grid{grid-template-columns:1fr 1fr;gap:24px}
}

#desk-welcome{display:none!important}
</style>
</head>
<body>

<div class="off-ban" id="offBan"><i class="fas fa-wifi-slash"></i> OFFLINE â€” QR Fallback Active</div>

<!-- ===================== LOGIN / SIDEBAR ===================== -->
<div class="scr on" id="s-login">
<div class="lg">
  <div class="lg-logos">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAACQCAYAAADnRuK4AAAB..." alt="Legality HSSE" style="width:64px;height:auto;filter:drop-shadow(0 4px 12px rgba(0,0,0,.2))">
  </div>
  <div class="lg-brand">
    <div style="font-size:9px;font-weight:600;color:var(--gold);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px">Security HSSE</div>
    <h1>MFPS v4.1</h1>
    <p>Material Flow Protection System</p>
    <div style="font-size:10px;color:var(--txt2);margin-top:5px;font-weight:500">PT. PERTAMINA PATRA NIAGA â€” RU V BALIKPAPAN</div>
    <div style="font-size:8px;color:var(--muted);margin-top:3px;font-family:'JetBrains Mono',monospace">Ref. TKO B07-009/KPI48540/2025-S9</div>
  </div>

  <div class="lg-roles" style="width:100%">
    <div class="role-grid-desk">
    <div class="rc" onclick="sr(this,'creator')" data-r="creator">
      <div class="rc-i" style="background:var(--blue)"><i class="fas fa-plus-circle"></i></div>
      <div class="rc-info"><div class="rc-n">MRA Creator</div><div class="rc-d">Pembuat Izin Pengeluaran Barang</div></div>
      <div class="rc-step">STEP 1</div>
    </div>
    <div class="rc" onclick="sr(this,'funchead')" data-r="funchead">
      <div class="rc-i" style="background:var(--green)"><i class="fas fa-user-tie"></i></div>
      <div class="rc-info"><div class="rc-n">Function Head</div><div class="rc-d">Persetujuan Lingkup Material</div></div>
      <div class="rc-step">STEP 2</div>
    </div>
    <div class="rc" onclick="sr(this,'legality')" data-r="legality">
      <div class="rc-i" style="background:var(--gold)"><i class="fas fa-scale-balanced"></i></div>
      <div class="rc-info"><div class="rc-n">Legality Officer</div><div class="rc-d">Verifikasi Digital & Kepatuhan Dokumen</div></div>
      <div class="rc-step">STEP 3</div>
    </div>
    <div class="rc" onclick="sr(this,'gate')" data-r="gate">
      <div class="rc-i" style="background:#6366F1"><i class="fas fa-magnifying-glass"></i></div>
      <div class="rc-info"><div class="rc-n">Gate Inspector</div><div class="rc-d">Pemeriksaan Fisik â€” Gate III/V/WS/WH</div></div>
      <div class="rc-step">STEP 4</div>
    </div>
    </div>

    <div class="lg-sec" style="margin-top:10px"><i class="fas fa-exclamation-circle" style="color:var(--high)"></i> Otorisasi Khusus</div>
    <div class="role-grid-desk">
    <div class="rc" onclick="sr(this,'sechead')" data-r="sechead">
      <div class="rc-i" style="background:var(--red)"><i class="fas fa-shield-halved"></i></div>
      <div class="rc-info"><div class="rc-n">Security Section Head</div><div class="rc-d">Otorisasi Kebijakan Khusus</div></div>
      <div class="rc-step">POLICY</div>
    </div>
    <div class="rc" onclick="sr(this,'ss')" data-r="ss">
      <div class="rc-i" style="background:var(--red)"><i class="fas fa-tower-broadcast"></i></div>
      <div class="rc-info"><div class="rc-n">Shift Superintendent</div><div class="rc-d">Otorisasi Kondisi Urgent/Darurat</div></div>
      <div class="rc-step">URGENT</div>
    </div>
    </div>

    <div class="lg-sec" style="margin-top:10px"><i class="fas fa-camera" style="color:var(--blue)"></i> Document Scanner (AI)</div>

    <div class="rc" onclick="sr(this,'scan')" data-r="scan">
      <div class="rc-i" style="background:var(--blue)"><i class="fas fa-camera"></i></div>
      <div class="rc-info"><div class="rc-n">Scan to Data</div><div class="rc-d">Foto Surat Jalan â†’ Claude AI â†’ Database</div></div>
      <div class="rc-step">AI</div>
    </div>
  </div>

  <button class="lg-btn" id="lBtn" disabled onclick="dl()"><i class="fas fa-fingerprint"></i>&nbsp; AUTHENTICATE & ENTER</button>
  <div class="lg-foot"><div class="lg-dot"></div>System Online â€” v4.1.0 Â· Kilang RU V Balikpapan</div>
</div>
</div>

<!-- ===== DESKTOP WELCOME ===== -->
<div id="desk-welcome">
  <i class="fas fa-shield-halved"></i>
  <p>MFPS v4.1</p>
  <small>Pilih role dari panel kiri untuk memulai</small>
</div>

<!-- ===================== CREATOR ===================== -->
<div class="scr" id="s-creator">
<div class="sbar"><span class="sbar-t" id="ck1"></span><span><i class="fas fa-signal"></i> <i class="fas fa-battery-three-quarters"></i></span></div>
<div class="hdr">
  <div class="hdr-l">
    <div class="hdr-bk" onclick="gl()"><i class="fas fa-arrow-left"></i></div>
    <div><div class="hdr-tt">Create MRA</div><div class="hdr-sub">Material Release Authorization</div></div>
  </div>
  <div class="hdr-r"><div class="hdr-btn"><i class="fas fa-clock-rotate-left"></i></div></div>
</div>
<div class="desk-content">
  <div class="steps">
    <div class="stp"><div class="stp-ln cr"></div><div class="stp-dot cr">1</div><div class="stp-lb">Create MRA</div></div>
    <div class="stp"><div class="stp-ln"></div><div class="stp-dot wt">2</div><div class="stp-lb">Func. Head</div></div>
    <div class="stp"><div class="stp-ln"></div><div class="stp-dot wt">3</div><div class="stp-lb">Legality</div></div>
    <div class="stp"><div class="stp-ln"></div><div class="stp-dot wt">4</div><div class="stp-lb">Gate</div></div>
  </div>

  <div class="desk-grid">
    <!-- GATE -->
    <div class="fs">
      <h3><i class="fas fa-door-open"></i> STEP 1 Â· DESTINATION GATE *</h3>
      <div class="dest-grid">
        <div class="dc" onclick="sd(this)"><i class="fas fa-road"></i><b>Gate 3</b><small>Pintu III</small></div>
        <div class="dc" onclick="sd(this)"><i class="fas fa-road"></i><b>Gate 5</b><small>Pintu V</small></div>
        <div class="dc" onclick="sd(this)"><i class="fas fa-warehouse"></i><b>Workshop</b><small>Gate Workshop</small></div>
        <div class="dc" onclick="sd(this)"><i class="fas fa-boxes-stacked"></i><b>Warehouse</b><small>Gate Warehouse</small></div>
      </div>
    </div>

    <!-- ITEM -->
    <div class="fs">
      <h3><i class="fas fa-tag"></i> STEP 2 Â· ITEM MANIFEST</h3>
      <div class="fr f1"><div class="fg"><label>Item Description * (Be Specific)</label><input type="text" placeholder="e.g. Limbah Logam (Scrap Steel) Â· 251 Kg"></div></div>
      <div class="fr">
        <div class="fg"><label>Quantity *</label><input type="number" value="0" min="0"></div>
        <div class="fg"><label>Unit</label><select><option>Unit</option><option>Pcs</option><option>Item</option><option>Kg</option><option>Liter</option><option>Set</option><option>Lot</option><option>Roll</option></select></div>
      </div>
      <div class="fr">
        <div class="fg"><label>Classification</label><select><option>General Cargo</option><option>Chemical / B3</option><option>Heavy Equipment</option><option>Tools</option><option>Scrap / Waste</option></select></div>
        <div class="fg"><label>Origin Location</label><select><option>Dalam Kilang</option><option>Plant 3</option><option>Plant 5</option><option>MA-1</option><option>MA-2</option><option>MA-3</option><option>Workshop</option><option>Warehouse</option></select></div>
      </div>
      <button class="btn btn-ol btn-sm"><i class="fas fa-plus"></i> Add Item</button>
    </div>

    <!-- TRANSPORTER -->
    <div class="fs">
      <h3><i class="fas fa-truck"></i> STEP 3 Â· TRANSPORTER</h3>
      <div class="fr">
        <div class="fg"><label>Driver Name *</label><input placeholder="Full name as per ID"></div>
        <div class="fg"><label>Vehicle Plate *</label><input placeholder="KT 8662 YC"></div>
      </div>
      <div class="fr">
        <div class="fg"><label>Vendor</label><select><option>â€” Select â€”</option><option>Malewa</option><option>PAR</option><option>PUM</option><option>Yokogawa</option><option>PT. Mulia Solusindo</option><option style="color:var(--extreme)">âš  PT. Jamin Jaya (HIGH RISK)</option></select></div>
        <div class="fg"><label>Vehicle Type</label><select><option>Conventional (ICE)</option><option style="color:var(--extreme)">â›” Electric (BLOCKED)</option></select></div>
      </div>
    </div>

    <!-- REFERENCE -->
    <div class="fs">
      <h3><i class="fas fa-file-alt"></i> STEP 4 Â· REFERENCE</h3>
      <div class="fr">
        <div class="fg"><label>PO / SPK No.</label><input placeholder="3950333491"></div>
        <div class="fg"><label>Surat Jalan</label><input placeholder="008/DO/RJ/XII/2025"></div>
      </div>
      <div class="fr f1"><div class="fg"><label>Destination Address</label><input placeholder="e.g. Gn. Pancur / Lahendong"></div></div>
    </div>

    <!-- SUBMIT -->
    <div class="desk-grid-full">
      <div class="al al-b"><i class="fas fa-fingerprint"></i><div><b>Non-Repudiation:</b> Identity, device, timestamp permanently recorded. Creator = accountable.</div></div>
      <div style="display:flex;gap:10px">
        <button class="btn btn-bl" style="flex:1" onclick="subMRA()"><i class="fas fa-paper-plane"></i> Submit MRA</button>
        <button class="btn btn-ol" style="flex:1"><i class="fas fa-save"></i> Save Draft</button>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== FUNCTION HEAD ===================== -->
<div class="scr" id="s-funchead">
<div class="sbar"><span class="sbar-t"></span><span><i class="fas fa-signal"></i></span></div>
<div class="hdr">
  <div class="hdr-l">
    <div class="hdr-bk" onclick="gl()"><i class="fas fa-arrow-left"></i></div>
    <div><div class="hdr-tt">Function Head Approval</div><div class="hdr-sub">Atasan User â€” Approve Material Scope</div></div>
  </div>
  <div class="hdr-r"><div class="hdr-btn"><i class="fas fa-bell"></i><span class="hdr-dot"></span></div></div>
</div>
<div class="desk-content">
  <div class="steps">
    <div class="stp"><div class="stp-ln dn"></div><div class="stp-dot dn"><i class="fas fa-check" style="font-size:9px"></i></div><div class="stp-lb">Created</div></div>
    <div class="stp"><div class="stp-ln cr"></div><div class="stp-dot cr">2</div><div class="stp-lb">Your Approval</div></div>
    <div class="stp"><div class="stp-ln"></div><div class="stp-dot wt">3</div><div class="stp-lb">Legality</div></div>
    <div class="stp"><div class="stp-ln"></div><div class="stp-dot wt">4</div><div class="stp-lb">Gate</div></div>
  </div>

  <div class="al al-y"><i class="fas fa-exclamation-triangle"></i><div><b>3 MRA pending.</b> Confirm materials are within your work scope and authorized for release.</div></div>

  <div class="desk-grid">
    <div>
      <div class="cd">
        <div class="cd-b" style="padding:0">
          <div class="qi" onclick="shFH()"><div class="qi-i" style="background:var(--high)"><i class="fas fa-file-signature"></i></div><div class="qi-inf"><div class="qi-tt">MRA-2026-0217-003</div><div class="qi-m">Ahmad R. Â· Fitriawan Putra<br>Panel Distribusi â€” 2 Unit â†’ <b>Gate 3</b></div></div><div class="qi-r"><div class="qi-tm">14:02</div><span class="badge b-o">PENDING</span></div></div>
          <div class="qi"><div class="qi-i" style="background:var(--medium)"><i class="fas fa-file-signature"></i></div><div class="qi-inf"><div class="qi-tt">MRA-2026-0217-006</div><div class="qi-m">Sholeh Â· PAR<br>Rubber Hose â€” 12 Roll â†’ <b>Gate 5</b></div></div><div class="qi-r"><div class="qi-tm">14:30</div><span class="badge b-o">PENDING</span></div></div>
          <div class="qi"><div class="qi-i" style="background:var(--extreme)"><i class="fas fa-file-signature"></i></div><div class="qi-inf"><div class="qi-tt">MRA-2026-0217-009</div><div class="qi-m">Iwan S. Â· PAR<br>Oil Cooler â€” 2 Pcs â†’ <b>Gate 3</b></div></div><div class="qi-r"><div class="qi-tm">15:58</div><span class="badge b-o">PENDING</span></div></div>
        </div>
      </div>
    </div>

    <div id="fhDet" style="display:none">
      <div class="cd" style="border-color:var(--teal)">
        <div class="cd-h" style="background:#F0FDFA"><div class="cd-t"><i class="fas fa-file-circle-check" style="color:var(--teal)"></i>Review MRA</div><span class="badge b-b">MRA-0217-003</span></div>
        <div class="cd-b">
          <div class="sr"><span class="sr-l">Creator</span><span class="sr-v">Ahmad Rizky</span></div>
          <div class="sr"><span class="sr-l">Vendor</span><span class="sr-v">PT. Fitriawan Putra</span></div>
          <div class="sr"><span class="sr-l">Item</span><span class="sr-v">Panel Distribusi</span></div>
          <div class="sr"><span class="sr-l">Qty</span><span class="sr-v">2 Unit</span></div>
          <div class="sr"><span class="sr-l">Route</span><span class="sr-v">Plant 5 â†’ MA-2</span></div>
          <div class="sr"><span class="sr-l">Exit Gate</span><span class="sr-v" style="color:var(--blue)">Gate 3</span></div>
          <div class="sr"><span class="sr-l">PO</span><span class="sr-v mono">4650002899</span></div>
          <div style="height:10px"></div>
          <div class="al al-b"><i class="fas fa-question-circle"></i><div>Are these materials within your work scope?</div></div>
          <div class="btn-rw"><button class="btn btn-gn btn-sm" onclick="apFH()"><i class="fas fa-check"></i> Approve</button><button class="btn btn-rd btn-sm"><i class="fas fa-ban"></i> Deny</button></div>
        </div>
      </div>
    </div>
    <div id="fhDetPlaceholder" style="display:flex;align-items:center;justify-content:center;height:180px;color:var(--muted);font-size:12px;background:#fff;border-radius:14px;border:1px dashed var(--bdr)"><span><i class="fas fa-hand-pointer"></i> Klik MRA untuk review</span></div>
  </div>
</div>
</div>

<!-- ===================== LEGALITY ===================== -->
<div class="scr" id="s-legality">
<div class="sbar"><span class="sbar-t"></span><span><i class="fas fa-signal"></i></span></div>
<div class="hdr" style="border-bottom-color:var(--gold)">
  <div class="hdr-l">
    <div class="hdr-bk" onclick="gl()"><i class="fas fa-arrow-left"></i></div>
    <div><div class="hdr-tt" style="color:var(--gold)">âš– Legality Verification</div><div class="hdr-sub">Digital Document Compliance</div></div>
  </div>
  <div class="hdr-r"><div class="hdr-btn"><i class="fas fa-bell"></i><span class="hdr-dot"></span></div></div>
</div>
<div class="desk-content">
  <div class="steps">
    <div class="stp"><div class="stp-ln dn"></div><div class="stp-dot dn"><i class="fas fa-check" style="font-size:9px"></i></div><div class="stp-lb">Created</div></div>
    <div class="stp"><div class="stp-ln dn"></div><div class="stp-dot dn"><i class="fas fa-check" style="font-size:9px"></i></div><div class="stp-lb">Func. Head âœ“</div></div>
    <div class="stp"><div class="stp-ln cr"></div><div class="stp-dot cr">3</div><div class="stp-lb">Your Verify</div></div>
    <div class="stp"><div class="stp-ln"></div><div class="stp-dot wt">4</div><div class="stp-lb">Gate</div></div>
  </div>

  <div class="desk-grid">
    <!-- Queue -->
    <div>
      <div class="cd" style="border-color:var(--gold)">
        <div class="cd-h" style="background:#FFFBEB"><div class="cd-t"><i class="fas fa-scale-balanced" style="color:var(--gold)"></i>Verification Queue</div><span class="badge b-gd">2 PENDING</span></div>
        <div class="cd-b" style="padding:0">
          <div class="qi" onclick="shLG()"><div class="qi-i" style="background:var(--gold)"><i class="fas fa-file-circle-check"></i></div><div class="qi-inf"><div class="qi-tt">MRA-2026-0217-003</div><div class="qi-m">Fitriawan Putra Â· Panel (2 Unit) â†’ Gate 3<br><span style="color:var(--green)">âœ“ Func. Head Approved 14:08</span></div></div><div class="qi-r"><span class="badge b-gd">VERIFY</span></div></div>
          <div class="qi"><div class="qi-i" style="background:var(--gold)"><i class="fas fa-file-circle-check"></i></div><div class="qi-inf"><div class="qi-tt">MRA-2026-0217-006</div><div class="qi-m">PAR Â· Rubber Hose (12 Roll) â†’ Gate 5<br><span style="color:var(--green)">âœ“ Func. Head Approved 14:35</span></div></div><div class="qi-r"><span class="badge b-gd">VERIFY</span></div></div>
        </div>
      </div>

      <!-- Database -->
      <div class="cd" style="border-color:var(--blue)">
        <div class="cd-h" style="background:#EFF6FF"><div class="cd-t"><i class="fas fa-database" style="color:var(--blue)"></i>Database Terintegrasi</div><span class="badge b-b">SEARCH</span></div>
        <div class="cd-b">
          <div class="fr f1" style="margin-bottom:8px"><div class="fg"><label>Cari MRA / Vendor / Item</label><input type="text" placeholder="Ketik..." id="dbSearch" oninput="dbFilter()"></div></div>
          <div class="fr" style="margin-bottom:8px">
            <div class="fg"><label>Status</label><select id="dbStatus" onchange="dbFilter()"><option value="">Semua</option><option>RELEASED</option><option>PENDING</option><option>REJECTED</option><option>NC RAISED</option></select></div>
            <div class="fg"><label>Gate</label><select id="dbGate" onchange="dbFilter()"><option value="">Semua</option><option>Gate 3</option><option>Gate 5</option><option>Workshop</option></select></div>
          </div>
          <div style="font-size:9px;font-weight:700;color:var(--blue);margin-bottom:6px;display:flex;justify-content:space-between"><span><i class="fas fa-table"></i> HASIL</span><span id="dbCount" style="color:var(--muted)">5 data</span></div>
          <div id="dbResults" style="max-height:200px;overflow-y:auto;border:1px solid var(--bdr);border-radius:8px">
            <div class="qi" style="border-bottom:1px solid var(--bdr)"><div class="qi-i" style="background:var(--green);width:28px;height:28px;border-radius:6px;font-size:10px"><i class="fas fa-check"></i></div><div class="qi-inf"><div class="qi-tt" style="font-size:10.5px">MRA-0217-001 Â· PAR</div><div class="qi-m" style="font-size:9px">Pipe Fitting â€” 24 Pcs â†’ Gate 5 Â· <span style="color:var(--green)">RELEASED</span></div></div></div>
            <div class="qi" style="border-bottom:1px solid var(--bdr)"><div class="qi-i" style="background:var(--green);width:28px;height:28px;border-radius:6px;font-size:10px"><i class="fas fa-check"></i></div><div class="qi-inf"><div class="qi-tt" style="font-size:10.5px">MRA-0217-002 Â· Malewa</div><div class="qi-m" style="font-size:9px">Scrap Steel â€” 1800 Kg â†’ Gate 3 Â· <span style="color:var(--green)">RELEASED</span></div></div></div>
            <div class="qi" style="border-bottom:1px solid var(--bdr)"><div class="qi-i" style="background:var(--extreme);width:28px;height:28px;border-radius:6px;font-size:10px"><i class="fas fa-ban"></i></div><div class="qi-inf"><div class="qi-tt" style="font-size:10.5px">MRA-0217-004 Â· Jamin Jaya</div><div class="qi-m" style="font-size:9px">"Material" (vague!) â†’ <span style="color:var(--extreme)">REJECTED â€” R03</span></div></div></div>
            <div class="qi" style="border-bottom:1px solid var(--bdr)"><div class="qi-i" style="background:var(--medium);width:28px;height:28px;border-radius:6px;font-size:10px"><i class="fas fa-triangle-exclamation"></i></div><div class="qi-inf"><div class="qi-tt" style="font-size:10.5px">MRA-0217-005 Â· PUM</div><div class="qi-m" style="font-size:9px">Valve 4" â€” 6 Pcs Â· <span style="color:var(--medium)">NC RAISED</span></div></div></div>
            <div class="qi"><div class="qi-i" style="background:var(--gold);width:28px;height:28px;border-radius:6px;font-size:10px"><i class="fas fa-clock"></i></div><div class="qi-inf"><div class="qi-tt" style="font-size:10.5px">MRA-0217-003 Â· Fitriawan</div><div class="qi-m" style="font-size:9px">Panel â€” 2 Unit Â· <span style="color:var(--gold)">PENDING VERIFY</span></div></div></div>
          </div>
          <div style="height:8px"></div>
          <div class="btn-rw"><button class="btn btn-ol btn-sm"><i class="fas fa-file-export"></i> Export CSV</button><button class="btn btn-ol btn-sm"><i class="fas fa-print"></i> Cetak</button></div>
        </div>
      </div>
    </div>

    <!-- Document Check -->
    <div>
      <div id="lgDetPlaceholder" style="display:flex;align-items:center;justify-content:center;height:160px;color:var(--muted);font-size:12px;background:#fff;border-radius:14px;border:1px dashed var(--bdr);margin-bottom:12px"><span><i class="fas fa-hand-pointer"></i> Klik queue untuk verifikasi</span></div>
      <div class="cd" id="lgDet" style="display:none;border-color:var(--gold)">
        <div class="cd-h" style="background:#FFFBEB"><div class="cd-t"><i class="fas fa-clipboard-check" style="color:var(--gold)"></i>Document Check</div><span class="badge b-b">MRA-003</span></div>
        <div class="cd-b">
          <div style="font-size:10px;font-weight:700;color:var(--gold);margin-bottom:6px">DOCUMENT CHECKLIST</div>
          <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">Surat Jalan / Delivery Order</div><div class="ck-st" style="color:var(--muted)">TAP</div></div>
          <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">PO / SPK / Contract</div><div class="ck-st" style="color:var(--muted)">TAP</div></div>
          <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">MRA Digital Completeness</div><div class="ck-st" style="color:var(--muted)">TAP</div></div>
          <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">Function Head Authorization âœ“</div><div class="ck-st" style="color:var(--muted)">TAP</div></div>
          <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">HSSE Safety Sticker</div><div class="ck-st" style="color:var(--muted)">TAP</div></div>
          <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">Digitalâ€“Physical Cross-Ref</div><div class="ck-st" style="color:var(--muted)">TAP</div></div>
          <div style="height:10px"></div>
          <div class="btn-rw"><button class="btn btn-gd btn-sm" onclick="stmp()"><i class="fas fa-stamp"></i> Digital Stamp</button><button class="btn btn-rd btn-sm"><i class="fas fa-triangle-exclamation"></i> Raise NC</button></div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== GATE ===================== -->
<div class="scr" id="s-gate">
<div class="sbar"><span class="sbar-t"></span><span><i class="fas fa-signal"></i></span></div>
<div class="hdr" style="border-bottom-color:#6366F1">
  <div class="hdr-l">
    <div class="hdr-bk" onclick="gl()"><i class="fas fa-arrow-left"></i></div>
    <div><div class="hdr-tt" style="color:#6366F1"><i class="fas fa-magnifying-glass"></i> Gate Inspection</div><div class="hdr-sub">Physical Verification â€” Gate 5</div></div>
  </div>
</div>
<div class="desk-content">
  <div class="steps">
    <div class="stp"><div class="stp-ln dn"></div><div class="stp-dot dn"><i class="fas fa-check" style="font-size:9px"></i></div><div class="stp-lb">Created</div></div>
    <div class="stp"><div class="stp-ln dn"></div><div class="stp-dot dn"><i class="fas fa-check" style="font-size:9px"></i></div><div class="stp-lb">Approved</div></div>
    <div class="stp"><div class="stp-ln dn"></div><div class="stp-dot dn"><i class="fas fa-check" style="font-size:9px"></i></div><div class="stp-lb">Legality âœ“</div></div>
    <div class="stp"><div class="stp-ln"></div><div class="stp-dot cr">4</div><div class="stp-lb">Your Check</div></div>
  </div>

  <div class="al al-b" style="margin-bottom:16px"><i class="fas fa-qrcode"></i><div>Scan MRA QR Code atau input ID manual.</div></div>

  <div class="desk-grid">
    <div>
      <div class="fs" style="margin-bottom:14px">
        <h3><i class="fas fa-search"></i> SCAN / INPUT MRA</h3>
        <div class="fr f1"><div class="fg"><label>MRA ID</label><input value="MRA-2026-0217-003"></div></div>
        <button class="btn btn-bl btn-sm" style="margin-top:8px"><i class="fas fa-qrcode"></i> Scan QR</button>
      </div>

      <div class="cd" style="border-color:#6366F1">
        <div class="cd-h" style="background:#EEF2FF"><div class="cd-t"><i class="fas fa-info-circle" style="color:#6366F1"></i>MRA Detail</div><span class="stamp st-gd"><i class="fas fa-scale-balanced"></i> LEGALITY âœ“</span></div>
        <div class="cd-b">
          <div class="sr"><span class="sr-l">Item</span><span class="sr-v">Panel Distribusi</span></div>
          <div class="sr"><span class="sr-l">Qty (Manifest)</span><span class="sr-v">2 Unit</span></div>
          <div class="sr"><span class="sr-l">Driver</span><span class="sr-v">Ruspandi Â· KT 8716 YZ</span></div>
          <div class="sr"><span class="sr-l">Route</span><span class="sr-v">Plant 5 â†’ Gate 3</span></div>
          <div class="sr"><span class="sr-l">Vendor</span><span class="sr-v">PT. Fitriawan Putra</span></div>
        </div>
      </div>
    </div>

    <div class="cd" style="border-color:#6366F1">
      <div class="cd-h" style="background:#EEF2FF"><div class="cd-t"><i class="fas fa-clipboard-list" style="color:#6366F1"></i>Physical Inspection Checklist</div></div>
      <div class="cd-b">
        <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">Item matches description</div></div>
        <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">Quantity = manifest count</div></div>
        <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">Vehicle plate confirmed</div></div>
        <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">Driver ID verified</div></div>
        <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">No unauthorized items</div></div>
        <div class="ck" onclick="tc(this)"><div class="ck-bx"><i class="fas fa-check"></i></div><div class="ck-lb">HSSE sticker valid</div></div>
        <div style="height:10px"></div>
        <div class="btn-rw"><button class="btn btn-gn btn-sm"><i class="fas fa-check-double"></i> RELEASE</button><button class="btn btn-rd btn-sm"><i class="fas fa-ban"></i> DISCREPANCY</button></div>
        <div class="al al-r" style="margin-top:8px;margin-bottom:0"><i class="fas fa-robot"></i><div>DISCREPANCY â†’ vehicle <b>auto-held</b>, MRA <b>locked</b>, creator <b>flagged</b>.</div></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== SEC HEAD ===================== -->
<div class="scr" id="s-sechead">
<div class="sbar"><span class="sbar-t"></span><span><i class="fas fa-signal"></i></span></div>
<div class="hdr" style="border-bottom-color:var(--navy)">
  <div class="hdr-l">
    <div class="hdr-bk" onclick="gl()"><i class="fas fa-arrow-left"></i></div>
    <div><div class="hdr-tt"><i class="fas fa-shield-halved"></i> Section Head</div><div class="hdr-sub">Special Policy Authorization</div></div>
  </div>
  <div class="hdr-r"><div class="hdr-btn"><i class="fas fa-bell"></i><span class="hdr-dot"></span></div></div>
</div>
<div class="desk-content">
  <div class="al al-o"><i class="fas fa-gavel"></i><div><b>1 Policy Request</b> â€” Exception cases requiring your discretionary authority.</div></div>
  <div class="desk-grid">
    <div class="cd" style="border-color:var(--navy)">
      <div class="cd-h" style="background:#E8ECF4"><div class="cd-t"><i class="fas fa-gavel"></i>Policy Authorization</div><span class="badge b-r">ESCALATED</span></div>
      <div class="cd-b">
        <div class="sr"><span class="sr-l">Case</span><span class="sr-v mono">POL-2026-004</span></div>
        <div class="sr"><span class="sr-l">Type</span><span class="sr-v" style="color:var(--high)">Management Override</span></div>
        <div class="sr"><span class="sr-l">Subject</span><span class="sr-v">Off-spec release without Procurement</span></div>
        <div class="sr"><span class="sr-l">Stats</span><span class="sr-v">18 OBC Â· 12 Released Â· 1 Rejected</span></div>
        <div style="height:8px"></div>
        <div class="btn-rw"><button class="btn btn-bl btn-sm" onclick="alert('âœ… Authorized â€” POL-2026-004')"><i class="fas fa-stamp"></i> Authorize</button><button class="btn btn-rd btn-sm"><i class="fas fa-ban"></i> Deny</button></div>
      </div>
    </div>
    <div class="cd">
      <div class="cd-h"><div class="cd-t"><i class="fas fa-chart-bar"></i>Ringkasan Hari Ini</div></div>
      <div class="cd-b">
        <div class="sr"><span class="sr-l">Total MRA</span><span class="sr-v">31</span></div>
        <div class="sr"><span class="sr-l">Released</span><span class="sr-v" style="color:var(--green)">24</span></div>
        <div class="sr"><span class="sr-l">Pending</span><span class="sr-v" style="color:var(--gold)">5</span></div>
        <div class="sr"><span class="sr-l">Rejected</span><span class="sr-v" style="color:var(--red)">2</span></div>
        <div class="sr"><span class="sr-l">NC Raised</span><span class="sr-v" style="color:var(--high)">3</span></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== SS ===================== -->
<div class="scr" id="s-ss">
<div class="sbar" style="background:var(--red)"><span class="sbar-t"></span><span><i class="fas fa-tower-broadcast"></i> CCR</span></div>
<div class="hdr" style="border-bottom-color:var(--red)">
  <div class="hdr-l">
    <div class="hdr-bk" onclick="gl()"><i class="fas fa-arrow-left"></i></div>
    <div><div class="hdr-tt" style="color:var(--red)"><i class="fas fa-tower-broadcast"></i> Shift Superintendent</div><div class="hdr-sub">CCR â€” Urgent Authorization</div></div>
  </div>
</div>
<div class="desk-content">
  <div class="al al-r"><i class="fas fa-bolt"></i><div><b>URGENT:</b> Movement outside normal hours. Your auth replaces Function Head (Step 2). Legality + Gate still required.</div></div>
  <div class="desk-grid">
    <div class="cd" style="border-color:var(--red)">
      <div class="cd-h" style="background:#FEF2F2"><div class="cd-t"><i class="fas fa-bolt" style="color:var(--red)"></i>Urgent MRA</div><span class="badge b-r">EMERGENCY</span></div>
      <div class="cd-b">
        <div class="sr"><span class="sr-l">MRA ID</span><span class="sr-v mono">MRA-URG-001</span></div>
        <div class="sr"><span class="sr-l">Time</span><span class="sr-v" style="color:var(--extreme)">22:15 (After Hours)</span></div>
        <div class="sr"><span class="sr-l">Item</span><span class="sr-v">Pompa No.15 â€” 1 Unit</span></div>
        <div class="sr"><span class="sr-l">Reason</span><span class="sr-v">Emergency pump replacement</span></div>
        <div class="sr"><span class="sr-l">Gate</span><span class="sr-v" style="color:var(--blue)">Gate 5</span></div>
        <div style="height:8px"></div>
        <div class="btn-rw"><button class="btn btn-rd btn-sm" onclick="alert('âš¡ URGENT AUTHORIZED â†’ Legality + Gate wajib!')"><i class="fas fa-bolt"></i> Authorize</button><button class="btn btn-ol btn-sm"><i class="fas fa-ban"></i> Deny</button></div>
      </div>
    </div>
    <div class="cd" style="border-color:var(--medium)">
      <div class="cd-h" style="background:#FFFBEB"><div class="cd-t"><i class="fas fa-wifi-slash" style="color:var(--medium)"></i>Offline Fallback Protocol</div></div>
      <div class="cd-b" style="font-size:11px;color:var(--txt2);line-height:1.8">
        <b>Jika gawai tidak tersedia:</b><br>
        â‘  <b>QR Fallback Form</b> â€” Form cetak + QR unik, discan retroaktif<br>
        â‘¡ <b>SMS Auth:</b> <span class="mono">AUTH [MRA-ID] [GATE] [OK/NO]</span><br>
        â‘¢ <b>Voice Call</b> â€” Recorded + timestamped<br>
        â‘£ <b>Rekonsiliasi</b> â€” Digital entry sebelum 08:00 WITA<br><br>
        <div class="stamp st-r"><i class="fas fa-exclamation-triangle"></i> Max 3 offline MRA per shift</div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ===================== SCAN TO DATA ===================== -->
<div class="scr" id="s-scan">
<div class="sbar"><span class="sbar-t"></span><span><i class="fas fa-signal"></i></span></div>
<div class="hdr" style="border-bottom-color:var(--blue)">
  <div class="hdr-l">
    <div class="hdr-bk" onclick="gl()"><i class="fas fa-arrow-left"></i></div>
    <div><div class="hdr-tt" style="color:var(--blue)"><i class="fas fa-camera"></i> Scan to Data</div><div class="hdr-sub">AI Document Scanner â†’ Database</div></div>
  </div>
</div>
<div class="desk-content">
  <div class="al al-b" style="margin-bottom:16px"><i class="fas fa-magic"></i><div><b>AI Document Scanner</b> â€” Foto Surat Jalan / Delivery Order / Bon Bintang â†’ Claude AI baca termasuk tulisan tangan â†’ data otomatis masuk Database.</div></div>

  <div class="desk-grid">
    <!-- Scan Panel -->
    <div>
      <div class="cd" style="border-color:var(--navy);margin-bottom:14px">
        <div class="cd-h" style="background:#F0F4FF"><div class="cd-t"><i class="fas fa-key" style="color:var(--navy)"></i>API Key</div><span class="badge" style="background:#E0E7FF;color:var(--navy)">1x SETUP</span></div>
        <div class="cd-b">
          <div class="fg"><label>Anthropic API Key</label><input id="scanApiKey" type="password" placeholder="sk-ant-api03-..."></div>
          <div style="font-size:9px;color:var(--muted);margin-bottom:8px"><i class="fas fa-lock"></i> Tersimpan di perangkat saja.</div>
          <button class="btn btn-sm" style="background:var(--navy);color:#fff;width:100%;justify-content:center" onclick="saveKey()"><i class="fas fa-save"></i> Simpan API Key</button>
        </div>
      </div>

      <div class="cd" style="border-color:var(--blue)">
        <div class="cd-h" style="background:#EFF6FF"><div class="cd-t"><i class="fas fa-camera" style="color:var(--blue)"></i>Scan Dokumen</div></div>
        <div class="cd-b">
          <div class="fg" style="margin-bottom:10px"><label>Tipe Dokumen</label><select id="scanDocType"><option value="masuk">ðŸ“¥ Barang MASUK (Surat Jalan / DO)</option><option value="keluar">ðŸ“¤ Barang KELUAR (Bon Bintang / Manifest)</option></select></div>
          <input type="file" id="scanFileInput" accept="image/*,application/pdf" capture="environment" style="display:none" onchange="handleScanFile(this)">
          <div style="display:flex;gap:8px;margin-bottom:10px">
            <button class="btn btn-sm" style="flex:1;justify-content:center;background:var(--blue);color:#fff" onclick="document.getElementById('scanFileInput').setAttribute('capture','environment');document.getElementById('scanFileInput').click()"><i class="fas fa-camera"></i> Ambil Foto</button>
            <button class="btn btn-sm" style="flex:1;justify-content:center;background:transparent;color:var(--blue);border:1.5px solid var(--blue)" onclick="document.getElementById('scanFileInput').removeAttribute('capture');document.getElementById('scanFileInput').click()"><i class="fas fa-file-image"></i> Pilih File</button>
          </div>
          <div id="scanPreview" style="display:none">
            <img id="scanPrevImg" style="width:100%;border-radius:8px;border:1px solid var(--bdr);margin-bottom:8px">
            <button class="btn btn-sm" style="width:100%;justify-content:center;background:var(--green);color:#fff" onclick="runAIScan()"><i class="fas fa-wand-magic-sparkles"></i> Proses dengan Claude AI</button>
          </div>
          <div id="scanLoading" style="display:none;text-align:center;padding:20px">
            <i class="fas fa-spinner fa-spin" style="font-size:28px;color:var(--gold)"></i>
            <div style="font-size:13px;font-weight:700;color:var(--gold);margin-top:8px">Membaca Dokumen...</div>
            <div style="font-size:10px;color:var(--muted)">Claude AI sedang extract data</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Database Panel -->
    <div>
      <div id="scanResultArea" style="display:none;margin-bottom:12px"></div>
      <div class="cd" style="border-color:var(--blue)">
        <div class="cd-h" style="background:#EFF6FF"><div class="cd-t"><i class="fas fa-database" style="color:var(--blue)"></i>Database Hasil Scan</div><span class="badge b-b" id="scanDbCount">0 data</span></div>
        <div class="cd-b">
          <div class="fg" style="margin-bottom:8px"><label>Cari</label><input id="scanDbSearch" placeholder="PO / Vendor / Material..." oninput="filterScanDb()"></div>
          <div class="fg" style="margin-bottom:8px"><label>Filter</label><select id="scanDbFilter" onchange="filterScanDb()"><option value="">Semua</option><option value="masuk">Barang Masuk</option><option value="keluar">Barang Keluar</option></select></div>
          <div id="scanDbList" style="max-height:280px;overflow-y:auto;border:1px solid var(--bdr);border-radius:8px">
            <div style="padding:20px;text-align:center;color:var(--muted);font-size:11px"><i class="fas fa-camera-retro" style="font-size:24px;display:block;margin-bottom:8px;opacity:.4"></i>Belum ada data scan.</div>
          </div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn btn-sm" style="flex:1;justify-content:center;background:transparent;color:var(--blue);border:1.5px solid var(--blue)" onclick="exportScanCSV()"><i class="fas fa-file-export"></i> Export CSV</button>
            <button class="btn btn-sm" style="flex:1;justify-content:center;background:transparent;color:var(--red);border:1.5px solid var(--red)" onclick="if(confirm('Hapus semua data scan?')){localStorage.removeItem('mfps_scan_db');renderScanDb()}"><i class="fas fa-trash"></i> Reset</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<script>
let role=null;
const isDesktop=()=>window.innerWidth>=768;

function sr(el,r){
  document.querySelectorAll('.rc').forEach(c=>c.classList.remove('sel'));
  el.classList.add('sel');
  role=r;
  document.getElementById('lBtn').disabled=false;
  // Di desktop, langsung tampilkan konten tanpa klik tombol
  if(isDesktop()) dl();
}

function dl(){
  if(!role)return;
  // Sembunyikan welcome dan semua scr kecuali login
  const welcome=document.getElementById('desk-welcome');
  if(welcome) welcome.style.display='none';
  document.querySelectorAll('.scr:not(#s-login)').forEach(s=>s.classList.remove('on'));
  document.getElementById('s-'+role).classList.add('on');
}

function gl(){
  if(isDesktop()){
    // Di desktop: kembali ke welcome, login tetap di kiri
    document.querySelectorAll('.scr:not(#s-login)').forEach(s=>s.classList.remove('on'));
    const welcome=document.getElementById('desk-welcome');
    if(welcome) welcome.style.display='flex';
    role=null;
    document.getElementById('lBtn').disabled=true;
    document.querySelectorAll('.rc').forEach(c=>c.classList.remove('sel'));
  } else {
    // Di mobile: kembali ke login screen
    document.querySelectorAll('.scr').forEach(s=>s.classList.remove('on'));
    document.getElementById('s-login').classList.add('on');
    role=null;
    document.getElementById('lBtn').disabled=true;
    document.querySelectorAll('.rc').forEach(c=>c.classList.remove('sel'));
  }
}

function sd(el){document.querySelectorAll('.dc').forEach(c=>c.classList.remove('sel'));el.classList.add('sel')}

function subMRA(){
  const d=document.querySelector('.dc.sel');
  if(!d){alert('âš  Pilih Gate Tujuan terlebih dahulu');return}
  alert('âœ… MRA Submitted!\n\nMRA-2026-0217-'+Math.floor(Math.random()*900+100)+'\n\nNotifikasi dikirim ke:\nâ†’ Function Head (Approval)\nâ†’ Legality Officer (Queued)\n\nGate: '+d.querySelector('b').textContent)
}

function shFH(){
  document.getElementById('fhDet').style.display='block';
  document.getElementById('fhDetPlaceholder').style.display='none';
}
function apFH(){
  document.getElementById('fhDet').innerHTML='<div class="cd-b"><div class="stamp st-g" style="width:100%;justify-content:center;padding:14px;margin-top:8px"><i class="fas fa-check-circle" style="font-size:16px"></i> APPROVED â†’ Forwarded to Legality Officer</div></div>';
}
function shLG(){
  document.getElementById('lgDet').style.display='block';
  document.getElementById('lgDetPlaceholder').style.display='none';
}
function tc(el){
  const b=el.querySelector('.ck-bx'),s=el.querySelector('.ck-st');
  if(b.classList.contains('ok')){b.classList.remove('ok');b.classList.add('fl');if(s){s.textContent='FAIL';s.style.color='var(--extreme)'}}
  else if(b.classList.contains('fl')){b.classList.remove('fl');if(s){s.textContent='TAP';s.style.color='var(--muted)'}}
  else{b.classList.add('ok');if(s){s.textContent='OK';s.style.color='var(--green)'}}
}
function stmp(){alert('âš– DIGITAL STAMP APPLIED\n\nLegality Officer: Andri Yulianto\nTimestamp: '+new Date().toISOString()+'\nâ†’ Forwarded to Gate Inspector')}
function dbFilter(){
  const s=document.getElementById('dbSearch').value.toLowerCase();
  const rows=document.querySelectorAll('#dbResults .qi');
  let c=0;rows.forEach(r=>{const t=r.textContent.toLowerCase();const m=!s||t.includes(s);r.style.display=m?'flex':'none';if(m)c++});
  document.getElementById('dbCount').textContent=c+' data';
}

// Clock
function uc(){const t=new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit',timeZone:'Asia/Makassar'})+' WITA';document.querySelectorAll('.sbar-t').forEach(e=>{if(e.id==='ck1'||!e.id)e.textContent=t})}uc();setInterval(uc,30000);

// Offline
window.addEventListener('offline',()=>document.getElementById('offBan').classList.add('show'));
window.addEventListener('online',()=>document.getElementById('offBan').classList.remove('show'));

// Desktop init
window.addEventListener('DOMContentLoaded',()=>{
  if(isDesktop()){
    const welcome=document.getElementById('desk-welcome');
    if(welcome) welcome.style.display='flex';
  }
  const k=localStorage.getItem('mfps_api_key');
  if(k){const el=document.getElementById('scanApiKey');if(el)el.value=k}
  renderScanDb();
});

// ===== SCAN =====
function saveKey(){
  const v=document.getElementById('scanApiKey').value;
  if(!v){alert('âš  Masukkan API Key');return}
  localStorage.setItem('mfps_api_key',v);
  alert('âœ“ API Key tersimpan!');
}

let scanImgB64='';
function handleScanFile(inp){
  const f=inp.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=e=>{scanImgB64=e.target.result;document.getElementById('scanPrevImg').src=scanImgB64;document.getElementById('scanPreview').style.display='block'};
  r.readAsDataURL(f);
}

async function runAIScan(){
  const apiKey=localStorage.getItem('mfps_api_key');
  if(!apiKey){alert('âš  Set API Key dulu');return}
  if(!scanImgB64){alert('âš  Pilih foto dulu');return}
  const docType=document.getElementById('scanDocType').value;
  document.getElementById('scanLoading').style.display='block';
  document.getElementById('scanResultArea').style.display='none';
  const mType=scanImgB64.includes('image/png')?'image/png':scanImgB64.includes('application/pdf')?'application/pdf':'image/jpeg';
  const b64=scanImgB64.split(',')[1];
  const srcType=mType==='application/pdf'?'document':'image';
  const prompt=docType==='masuk'?
    'Baca Surat Jalan/Delivery Order barang MASUK ini (termasuk tulisan tangan). Kembalikan HANYA JSON tanpa backtick: {"tipe":"masuk","no_po":"","no_do":"","vendor":"","tanggal":"","no_polisi":"","nama_supir":"","items":[{"no":1,"qty":"","unit":"","material":"","remarks":""}],"total_items":0,"catatan":""}':
    'Baca Bon Bintang/Manifest barang KELUAR ini (termasuk tulisan tangan). Kembalikan HANYA JSON tanpa backtick: {"tipe":"keluar","no_bon":"","tanggal":"","dari":"","tujuan":"","area":"","items":[{"jumlah":"","kesatuan":"","keterangan":"","berat":""}],"no_kendaraan":"","nama_supir":"","pemohon":"","pengirim":"","penerima":"","catatan":""}';
  try{
    const resp=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':apiKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({model:'claude-sonnet-4-5-20250514',max_tokens:2000,messages:[{role:'user',content:[{type:srcType,source:{type:'base64',media_type:mType,data:b64}},{type:'text',text:prompt}]}]})
    });
    const data=await resp.json();
    document.getElementById('scanLoading').style.display='none';
    if(data.error){showScanError(data.error.message||JSON.stringify(data.error));return}
    const txt=data.content.map(c=>c.text||'').join('').replace(/```json|```/g,'').trim();
    let parsed;try{parsed=JSON.parse(txt)}catch(e){showScanError('Gagal parse: '+txt.substring(0,200));return}
    showScanResult(parsed);saveScanToDb(parsed);renderScanDb();
  }catch(err){
    document.getElementById('scanLoading').style.display='none';
    showScanError('Koneksi gagal: '+err.message);
  }
}

function showScanError(msg){
  document.getElementById('scanResultArea').style.display='block';
  document.getElementById('scanResultArea').innerHTML='<div style="background:#FEE2E2;padding:10px 14px;border-radius:12px;color:var(--red);font-size:11px;margin-bottom:12px"><i class="fas fa-exclamation-circle"></i> <b>Error:</b> '+msg+'</div>';
}
function showScanResult(d){
  document.getElementById('scanResultArea').style.display='block';
  let h='<div class="cd" style="border-color:var(--green);margin-bottom:12px"><div class="cd-h" style="background:#F0FDF4"><div class="cd-t"><i class="fas fa-check-circle" style="color:var(--green)"></i>Data Berhasil Diekstrak</div><span class="badge '+(d.tipe==='masuk'?'b-b':'b-o')+'">'+(d.tipe==='masuk'?'MASUK':'KELUAR')+'</span></div><div class="cd-b">';
  if(d.tipe==='masuk'){
    h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:11px;margin-bottom:8px">';
    h+='<div><span style="color:var(--muted)">No. PO:</span> <b>'+(d.no_po||'-')+'</b></div><div><span style="color:var(--muted)">No. DO:</span> <b>'+(d.no_do||'-')+'</b></div>';
    h+='<div><span style="color:var(--muted)">Vendor:</span> <b>'+(d.vendor||'-')+'</b></div><div><span style="color:var(--muted)">Tanggal:</span> <b>'+(d.tanggal||'-')+'</b></div>';
    h+='<div><span style="color:var(--muted)">No. Polisi:</span> <b>'+(d.no_polisi||'-')+'</b></div><div><span style="color:var(--muted)">Supir:</span> <b>'+(d.nama_supir||'-')+'</b></div></div>';
    if(d.items&&d.items.length){h+='<div style="font-size:10px;font-weight:700;color:var(--navy);margin-bottom:4px">'+d.items.length+' ITEM</div><div style="max-height:140px;overflow-y:auto;border:1px solid var(--bdr);border-radius:6px;font-size:10px"><table style="width:100%;border-collapse:collapse"><tr style="background:#F3F4F6"><th style="padding:4px 6px;text-align:left">#</th><th style="padding:4px 6px;text-align:left">Qty</th><th style="padding:4px 6px;text-align:left">Unit</th><th style="padding:4px 6px;text-align:left">Material</th></tr>';d.items.forEach(i=>{h+='<tr style="border-top:1px solid var(--bdr)"><td style="padding:4px 6px">'+(i.no||'')+'</td><td style="padding:4px 6px">'+(i.qty||'')+'</td><td style="padding:4px 6px">'+(i.unit||'')+'</td><td style="padding:4px 6px">'+(i.material||'')+'</td></tr>'});h+='</table></div>';}
  } else {
    h+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:11px;margin-bottom:8px">';
    h+='<div><span style="color:var(--muted)">No. Bon:</span> <b>'+(d.no_bon||'-')+'</b></div><div><span style="color:var(--muted)">Tanggal:</span> <b>'+(d.tanggal||'-')+'</b></div>';
    h+='<div><span style="color:var(--muted)">Dari:</span> <b>'+(d.dari||'-')+'</b></div><div><span style="color:var(--muted)">Tujuan:</span> <b>'+(d.tujuan||'-')+'</b></div>';
    h+='<div><span style="color:var(--muted)">Kendaraan:</span> <b>'+(d.no_kendaraan||'-')+'</b></div><div><span style="color:var(--muted)">Supir:</span> <b>'+(d.nama_supir||'-')+'</b></div></div>';
    if(d.items&&d.items.length){h+='<div style="border:1px solid var(--bdr);border-radius:6px;font-size:10px"><table style="width:100%;border-collapse:collapse"><tr style="background:#F3F4F6"><th style="padding:4px 6px;text-align:left">Jumlah</th><th style="padding:4px 6px;text-align:left">Satuan</th><th style="padding:4px 6px;text-align:left">Keterangan</th></tr>';d.items.forEach(i=>{h+='<tr style="border-top:1px solid var(--bdr)"><td style="padding:4px 6px">'+(i.jumlah||'')+'</td><td style="padding:4px 6px">'+(i.kesatuan||'')+'</td><td style="padding:4px 6px">'+(i.keterangan||'')+'</td></tr>'});h+='</table></div>';}
  }
  h+='<div style="background:#D1FAE5;padding:8px;border-radius:6px;margin-top:10px;font-size:11px;color:var(--green);text-align:center"><i class="fas fa-database"></i> Data tersimpan ke Database</div></div></div>';
  document.getElementById('scanResultArea').innerHTML=h;
}

function loadScanDb(){try{return JSON.parse(localStorage.getItem('mfps_scan_db'))||[]}catch(e){return[]}}
function saveScanToDb(d){const db=loadScanDb();d._id='SCN-'+Date.now();d._scannedAt=new Date().toISOString();db.unshift(d);if(db.length>500)db.pop();localStorage.setItem('mfps_scan_db',JSON.stringify(db));}
function renderScanDb(){filterScanDb()}
function filterScanDb(){
  const db=loadScanDb();
  const q=(document.getElementById('scanDbSearch')?.value||'').toLowerCase();
  const ft=document.getElementById('scanDbFilter')?.value||'';
  const filtered=db.filter(d=>{const matchType=!ft||d.tipe===ft;const txt=JSON.stringify(d).toLowerCase();return matchType&&(!q||txt.includes(q))});
  const countEl=document.getElementById('scanDbCount');if(countEl)countEl.textContent=filtered.length+' data';
  const list=document.getElementById('scanDbList');if(!list)return;
  if(!filtered.length){list.innerHTML='<div style="padding:20px;text-align:center;color:var(--muted);font-size:11px"><i class="fas fa-camera-retro" style="font-size:24px;display:block;margin-bottom:8px;opacity:.4"></i>Tidak ada data</div>';return}
  let h='';
  filtered.forEach(d=>{
    const isMasuk=d.tipe==='masuk';const color=isMasuk?'var(--blue)':'var(--high)';
    const label=isMasuk?(d.no_po||d.no_do||'-'):(d.no_bon||'-');
    const vendor=isMasuk?(d.vendor||'-'):(d.dari||'-');
    const itemCount=d.items?d.items.length:0;
    const time=d._scannedAt?new Date(d._scannedAt).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit',hour12:false}):'';
    const date=d._scannedAt?new Date(d._scannedAt).toLocaleDateString('id-ID',{day:'2-digit',month:'short'}):'';
    h+='<div class="qi" style="border-bottom:1px solid var(--bdr)"><div class="qi-i" style="background:'+color+';width:28px;height:28px;border-radius:6px;font-size:10px"><i class="fas fa-'+(isMasuk?'truck-ramp-box':'truck-arrow-right')+'"></i></div><div class="qi-inf"><div class="qi-tt" style="font-size:10.5px">'+label+' Â· '+vendor+'</div><div class="qi-m" style="font-size:9px">'+(isMasuk?'Masuk':'Keluar')+' â€” '+itemCount+' item Â· '+(d.tanggal||'-')+'<br><span style="color:'+color+'">'+date+' '+time+'</span></div></div></div>';
  });
  list.innerHTML=h;
}
function exportScanCSV(){
  const db=loadScanDb();if(!db.length){alert('Tidak ada data');return}
  let csv='Tipe,No Dokumen,Vendor/Dari,Tanggal,Item Count,No Kendaraan,Supir,Scanned At\n';
  db.forEach(d=>{const label=d.tipe==='masuk'?(d.no_po||d.no_do):(d.no_bon||'-');const vendor=d.tipe==='masuk'?(d.vendor||'-'):(d.dari||'-');const nopol=d.tipe==='masuk'?(d.no_polisi||'-'):(d.no_kendaraan||'-');csv+=d.tipe+','+label+','+vendor+','+(d.tanggal||'-')+','+(d.items?d.items.length:0)+','+nopol+','+(d.nama_supir||'-')+','+(d._scannedAt||'')+'\n'});
  const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='MFPS_ScanData_'+new Date().toISOString().split('T')[0]+'.csv';a.click();
}
</script>
</body>
</html>
